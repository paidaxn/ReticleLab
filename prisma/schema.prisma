// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                      String       @id @default(cuid())
  email                   String       @unique
  username                String       @unique
  passwordHash            String?
  avatarUrl               String?
  role                    String       @default("user")
  subscriptionTier        String       @default("free")
  subscriptionExpiresAt   DateTime?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt

  favorites               Favorite[]
  usageHistory            UsageHistory[]
}

model Crosshair {
  id                      String       @id @default(cuid())
  name                    String
  code                    String
  category                String
  playerId                String?
  
  // Crosshair parameters
  color                   String
  outlineColor            String
  centerDot               Boolean      @default(false)
  innerLines              String       // JSON string
  outerLines              String       // JSON string
  
  // Statistics
  views                   Int          @default(0)
  copies                  Int          @default(0)
  likes                   Int          @default(0)
  
  // Metadata
  tags                    String       // Comma-separated tags
  isVerified              Boolean      @default(false)
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt
  
  player                  Player?      @relation(fields: [playerId], references: [id])
  favorites               Favorite[]
  usageHistory            UsageHistory[]
}

model Player {
  id                      String       @id @default(cuid())
  name                    String
  team                    String?
  region                  String
  avatarUrl               String?
  isVerified              Boolean      @default(false)
  socialLinks             String?      // JSON string
  createdAt               DateTime     @default(now())
  
  crosshairs              Crosshair[]
}

model Favorite {
  userId                  String
  crosshairId             String
  createdAt               DateTime     @default(now())
  
  user                    User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  crosshair               Crosshair    @relation(fields: [crosshairId], references: [id], onDelete: Cascade)
  
  @@id([userId, crosshairId])
}

model UsageHistory {
  id                      String       @id @default(cuid())
  userId                  String
  crosshairId             String
  action                  String
  createdAt               DateTime     @default(now())
  
  user                    User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  crosshair               Crosshair    @relation(fields: [crosshairId], references: [id], onDelete: Cascade)
}